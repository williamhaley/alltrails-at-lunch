(this["webpackJsonpalltrails-at-lunch"]=this["webpackJsonpalltrails-at-lunch"]||[]).push([[0],{12:function(e,t,n){e.exports={container:"App_container__38atM",nav:"App_nav__2qex2",main:"App_main__3N4Nf"}},17:function(e,t,n){e.exports={item:"List_item__2TG5m"}},23:function(e,t,n){},32:function(e,t,n){},33:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n.n(a),s=n(11),r=n.n(s),l=(n(23),n(3)),i=n(15),o=n(10),d=function(){return Object(o.b)()},u=o.c,j=n(0),b=Object(a.createContext)({isGoogleLoaded:!1,mapInstance:null,setMapInstance:function(){}});var p,f,m=function(e){var t=e.children,n=Object(a.useState)(!1),c=Object(l.a)(n,2),s=c[0],r=c[1],i=Object(a.useState)(null),o=Object(l.a)(i,2),d=o[0],u=o[1];return Object(a.useEffect)((function(){return function(e,t){var n=document.createElement("script");n.setAttribute("src",e),n.addEventListener("load",t),document.head.appendChild(n)}("https://maps.googleapis.com/maps/api/js?key=".concat("AIzaSyDQSd210wKX_7cz9MELkxhaEOUhFP0AkSk","&libraries=places"),(function(){r(!0)})),function(){}}),[]),Object(j.jsx)(b.Provider,{value:{isGoogleLoaded:s,mapInstance:d,setMapInstance:u},children:t})},g=n(5),h=n.n(g),O=n(7),x=n(4);!function(e){e[e.RatingsDescending=0]="RatingsDescending",e[e.RatingsAscending=1]="RatingsAscending"}(p||(p={})),function(e){e[e.map=0]="map"}(f||(f={}));var v={places:[],selectedPlace:null,isLoading:!1,sort:p.RatingsDescending},y=Object(x.b)("places/search",function(){var e=Object(O.a)(h.a.mark((function e(t){var n,a,c,s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.coordinates,a=t.service,c=t.query,s={location:new google.maps.LatLng(n.latitude,n.longitude),keyword:c,radius:2e3,type:"restaurant"},e.abrupt("return",new Promise((function(e,t){a.nearbySearch(s,(function(n,a){if(![google.maps.places.PlacesServiceStatus.OK,google.maps.places.PlacesServiceStatus.ZERO_RESULTS].includes(a))return console.error("unexpected status when searching ".concat(a)),t(new Error("unknown error"));if(!n||0===n.length)return console.warn("no results [status=".concat(a,"] for ").concat(c)),e([]);var s=n.reduce((function(e,t){return t.geometry.location&&e.push({id:t.place_id,name:t.name,rating:t.rating,totalReviews:t.user_ratings_total,photoUrl:t.photos[0].getUrl({maxWidth:100,maxHeight:100}),priceLevel:t.price_level,coordinates:{latitude:t.geometry.location.lat(),longitude:t.geometry.location.lng()}}),e}),[]);return e(s)}))})));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),N=function(e,t){e.sort((function(e,n){return t===p.RatingsAscending?e.rating-n.rating:n.rating-e.rating}))},w=Object(x.c)({name:"places",initialState:v,reducers:{selectPlace:function(e,t){return e.selectedPlace=t.payload,e},toggleSort:function(e){return e.sort=e.sort===p.RatingsAscending?p.RatingsDescending:p.RatingsAscending,N(e.places,e.sort),e}},extraReducers:function(e){e.addCase(y.pending,(function(e){e.isLoading=!0})).addCase(y.fulfilled,(function(e,t){e.isLoading=!1;var n=t.payload;N(n,e.sort),null===e.selectedPlace||n.some((function(t){return t.id===e.selectedPlace.id}))||(e.selectedPlace=null),e.places=t.payload})).addCase(y.rejected,(function(e,t){console.error("error while getting places ".concat(t.payload)),e.isLoading=!1}))}}),L=w.actions,R=L.toggleSort,S=L.selectPlace,P=w.reducer,k=function(e){for(var t=e.rating,n=e.totalReviews,a=Math.floor(t),c=[],s=0;s<5;s++)c.push(Object(j.jsx)("i",{"data-testid":s<a?"filled-star":"empty-star",className:"bi ".concat(s<a?"text-warning bi-star-fill":"text-secondary bi-star")},s));return Object(j.jsxs)("span",{title:"".concat(t," star rating"),children:[c.map((function(e){return e}))," (",n,")"]})},I="favorites",C=function(){var e;return JSON.parse(null!==(e=localStorage.getItem(I))&&void 0!==e?e:JSON.stringify({}))},A={byId:C()},_=Object(x.c)({name:"favorites",initialState:A,reducers:{toggleFavorite:function(e,t){var n,a=t.payload,c=!(null!==(n=e.byId[a])&&void 0!==n&&n);e.byId[a]=c;var s=C();return s[a]=c,localStorage.setItem(I,JSON.stringify(s)),e}}}),E=_.actions.toggleFavorite,B=_.reducer,F=function(e){var t=d(),n=u((function(t){return{isFavorited:t.favorites.byId[e.place.id]}})).isFavorited;return Object(j.jsx)("button",{className:"btn btn-link",onClick:function(){t(E(e.place.id))},children:Object(j.jsx)("i",{className:"bi bi-heart".concat(n?"-fill":""," text-primary")})})},M=function(e){var t=Object(a.useState)(""),n=Object(l.a)(t,2),c=n[0],s=n[1];Object(a.useEffect)((function(){e.place.priceLevel&&s(new Array(e.place.priceLevel).fill("$").join(""))}),[e.place.priceLevel]);var r=e.type===f.map;return Object(j.jsxs)("div",{className:"".concat(e.className,' card "d-flex flex-row'),children:[Object(j.jsx)("div",{className:"d-flex align-items-center",children:Object(j.jsx)("img",{className:"me-3",style:{width:64,height:64,objectFit:"cover"},src:e.place.photoUrl,alt:e.place.name})}),Object(j.jsxs)("div",{className:"card-body p-0 overflow-hidden",children:[Object(j.jsx)("div",{className:"card-title mb-0 text-bold text-truncate",children:e.place.name}),Object(j.jsx)(k,{rating:e.place.rating,totalReviews:e.place.totalReviews}),c&&Object(j.jsx)("div",{className:"text-small",children:c})]}),!r&&Object(j.jsx)("div",{className:"d-flex align-items-start",children:Object(j.jsx)(F,{place:e.place})})]})},D=Object(a.forwardRef)((function(e,t){return Object(j.jsx)("div",{ref:t,children:Object(j.jsx)(M,{place:e.place,type:f.map,className:"border-0"})})})),T=function(e){var t=d(),n=u((function(e){return{coordinates:e.location.coordinates,places:e.places.places,selectedPlace:e.places.selectedPlace}})),c=n.coordinates,s=n.places,r=n.selectedPlace,o=Object(a.createRef)(),p=Object(a.useReducer)((function(e,t){return{oldByPlaceId:e.currentByPlaceId,currentByPlaceId:t}}),{oldByPlaceId:{},currentByPlaceId:{}}),f=Object(l.a)(p,2),m=f[0],g=f[1],h=Object(a.useContext)(b),O=h.isGoogleLoaded,x=h.mapInstance,v=h.setMapInstance;Object(a.useEffect)((function(){for(var e=0,t=Object.values(m.oldByPlaceId);e<t.length;e++){t[e].setMap(null)}}),[m,m.oldByPlaceId]),Object(a.useEffect)((function(){if(null!==N.current&&null!==r&&null!==o.current){var e=m.currentByPlaceId[r.id];N.current.setContent(o.current),N.current.open(x,e)}}),[r,s,x,m.currentByPlaceId,o]),Object(a.useEffect)((function(){if(null!==x){var e,n={},a=Object(i.a)(s);try{var c=function(){var a=e.value,c=new google.maps.Marker({map:x,position:new google.maps.LatLng(a.coordinates.latitude,a.coordinates.longitude)});google.maps.event.addListener(c,"click",(function(){t(S(a))})),n[a.id]=c};for(a.s();!(e=a.n()).done;)c()}catch(r){a.e(r)}finally{a.f()}g(n)}}),[t,s,x]);var y=Object(a.useRef)(null),N=Object(a.useRef)(null);Object(a.useEffect)((function(){if(O&&null!==c&&null===x&&null!==y.current){null===N.current&&(N.current=new google.maps.InfoWindow);var e=new google.maps.Map(y.current,{center:new google.maps.LatLng(c.latitude,c.longitude),zoom:15});v(e)}}),[O,x,v,c]);var w=null===c;return Object(j.jsxs)("div",{id:"map",className:"".concat(e.className," w-100 h-100"),ref:y,children:[w&&Object(j.jsx)("div",{className:"p-2",children:"Loading..."}),null!==r&&Object(j.jsx)(D,{ref:o,place:r})]})},q=n(18),G=[{text:"Ratings High to Low",sort:p.RatingsDescending},{text:"Ratings Low to High",sort:p.RatingsAscending}],J=Object(a.forwardRef)((function(e,t){var n=Object(a.useState)(e.sort),c=Object(l.a)(n,2),s=c[0],r=c[1];return Object(j.jsx)("div",{className:"modal fade",tabIndex:-1,ref:t,children:Object(j.jsx)("div",{className:"modal-dialog",children:Object(j.jsxs)("div",{className:"modal-content",children:[Object(j.jsx)("div",{className:"modal-body",children:Object(j.jsx)("form",{children:G.map((function(e,t){return Object(j.jsx)("div",{className:"form-check",children:Object(j.jsxs)("label",{className:"form-check-label",children:[Object(j.jsx)("input",{className:"form-check-input",name:"sort",type:"radio",onChange:function(){r(e.sort)},checked:s===e.sort}),e.text]})},t)}))})}),Object(j.jsx)("div",{className:"modal-footer",children:Object(j.jsx)("button",{type:"button",className:"btn btn-link","data-bs-dismiss":"modal",onClick:function(){e.onApply(s)},children:"Apply"})})]})})})})),U=function(){var e=d(),t=Object(a.createRef)(),n=Object(a.useRef)(null),c=u((function(e){return{sortType:e.places.sort}})).sortType,s=u((function(e){return{isLoadingResults:e.places.isLoading,coordinates:e.location.coordinates}})),r=s.isLoadingResults,l=s.coordinates;return Object(j.jsxs)("div",{children:[Object(j.jsx)("button",{className:"btn btn-outline-primary me-2",type:"button",disabled:r||null===l,onClick:function(){null!==t.current&&null===n.current&&(n.current=new q.a(t.current)),null!==n.current&&n.current.toggle()},children:"Sort"}),Object(j.jsx)(J,{ref:t,sort:c,onApply:function(t){t!==c&&e(R())}})]})},H=function(){var e=d(),t=u((function(e){return{isLoadingResults:e.places.isLoading,coordinates:e.location.coordinates}})),n=t.isLoadingResults,c=t.coordinates,s=Object(a.useContext)(b),r=s.isGoogleLoaded,i=s.mapInstance,o=Object(a.useState)(null),p=Object(l.a)(o,2),f=p[0],m=p[1];return Object(a.useEffect)((function(){r&&null!==i&&m(new google.maps.places.PlacesService(i))}),[r,i,c]),Object(j.jsx)("form",{onSubmit:function(){var t=Object(O.a)(h.a.mark((function t(a){var s,r,l;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.preventDefault(),!n){t.next=3;break}return t.abrupt("return");case 3:if(null!==f&&null!==c){t.next=6;break}return alert("unknown error"),t.abrupt("return");case 6:r=new FormData(a.target),l="".concat(null!==(s=r.get("query"))&&void 0!==s?s:"");try{e(y({service:f,coordinates:c,query:l}))}catch(i){console.error("error while searching ".concat(i))}case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),children:Object(j.jsxs)("div",{className:"input-group",children:[Object(j.jsx)("input",{type:"text",name:"query",disabled:n||null===c,className:"form-control",placeholder:"Search for a restaurant","aria-label":"Search for a restaurant"}),Object(j.jsx)("button",{className:"btn btn-outline-secondary",type:"submit",children:Object(j.jsx)("i",{className:"bi bi-search text-primary"})})]})})},z=function(e){return Object(j.jsx)("nav",{className:"".concat(e.className," d-flex navbar navbar-expand-lg navbar-light bg-white justify-content-between shadow-sm"),children:Object(j.jsxs)("div",{className:"container-fluid",children:[Object(j.jsxs)("a",{className:"navbar-brand d-flex justify-content-center justify-content-sm-start w-100",href:"/",children:[Object(j.jsx)("img",{src:"/logo.svg",alt:"AllTrails logo"})," ",Object(j.jsx)("span",{className:"ms-2 fs-4 text-muted",children:"at Lunch"})]}),Object(j.jsxs)("div",{className:"d-flex",children:[Object(j.jsx)(U,{}),Object(j.jsx)(H,{})]})]})})},K=Object(x.b)("location",Object(O.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){navigator.geolocation.getCurrentPosition((function(t){e({latitude:t.coords.latitude,longitude:t.coords.longitude})}),t,{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})})));case 1:case"end":return e.stop()}}),e)})))),W=Object(x.c)({name:"location",initialState:{value:0,isLoading:!1,coordinates:null},reducers:{},extraReducers:function(e){e.addCase(K.pending,(function(e,t){e.isLoading=!0})).addCase(K.fulfilled,(function(e,t){e.isLoading=!1,e.coordinates=t.payload})).addCase(K.rejected,(function(e,t){console.error("error while getting location ".concat(t.payload)),e.isLoading=!1}))}}).reducer,Q=Object(x.a)({reducer:{location:W,places:P,favorites:B}}),X=(n(32),n(12)),Z=n.n(X),$=n(17),V=n.n($),Y=function(e){var t=u((function(e){return{isLoadingResults:e.places.isLoading,places:e.places.places}})),n=t.isLoadingResults,a=t.places;return Object(j.jsx)("div",{className:"".concat(e.className," overflow-scroll h-100"),children:n?Object(j.jsx)("div",{className:"card p-3 mx-3","aria-hidden":"true",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsx)("h5",{className:"card-title placeholder-glow",children:Object(j.jsx)("span",{className:"placeholder col-6"})}),Object(j.jsxs)("p",{className:"card-text placeholder-glow",children:[Object(j.jsx)("span",{className:"placeholder col-7"}),Object(j.jsx)("span",{className:"placeholder col-4"}),Object(j.jsx)("span",{className:"placeholder col-4"}),Object(j.jsx)("span",{className:"placeholder col-6"}),Object(j.jsx)("span",{className:"placeholder col-8"})]})]})}):n||0!==a.length?a.map((function(e){return Object(j.jsx)(M,{className:"mb-2 p-2 mx-2 ".concat(V.a.item),place:e},e.id)})):Object(j.jsx)("div",{className:"card p-3 mx-3","aria-hidden":"true",children:Object(j.jsx)("div",{className:"card-body",children:Object(j.jsx)("h5",{className:"card-title",children:"No results! \ud83d\ude22"})})})})};Q.dispatch(K());var ee=function(){var e=Object(a.useState)(!1),t=Object(l.a)(e,2),n=t[0],c=t[1];return Object(j.jsx)(o.a,{store:Q,children:Object(j.jsx)(m,{children:Object(j.jsx)("div",{className:"vw-100 vh-100 bg-light",children:Object(j.jsxs)("div",{className:"container h-100 p-0 ".concat(Z.a.container),children:[Object(j.jsx)(z,{className:Z.a.nav}),Object(j.jsxs)("main",{className:"".concat(Z.a.main," overflow-hidden h-100"),children:[Object(j.jsxs)("div",{className:"row h-100",children:[Object(j.jsx)(Y,{className:"p-3 bg-light d-sm-block col-sm-4 ".concat(!n&&"d-none")}),Object(j.jsx)(T,{className:"d-sm-block col ".concat(n&&"d-none")})]}),Object(j.jsxs)("button",{className:"btn btn-primary d-sm-none mb-3 position-fixed start-50 fixed-bottom translate-middle text-white",onClick:function(){c(!n)},children:[Object(j.jsx)("i",{className:"me-1 bi bi-".concat(n?"geo-alt":"list-ul")}),n?"Map":"List"]})]})]})})})})},te=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,36)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,s=t.getLCP,r=t.getTTFB;n(e),a(e),c(e),s(e),r(e)}))};r.a.render(Object(j.jsx)(c.a.StrictMode,{children:Object(j.jsx)(ee,{})}),document.getElementById("root")),te()}},[[33,1,2]]]);
//# sourceMappingURL=main.0dd8cfc8.chunk.js.map