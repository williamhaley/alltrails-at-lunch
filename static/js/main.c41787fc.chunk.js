(this["webpackJsonpalltrails-at-lunch"]=this["webpackJsonpalltrails-at-lunch"]||[]).push([[0],{12:function(e,t,n){e.exports={container:"App_container__38atM",nav:"App_nav__2qex2",main:"App_main__3N4Nf"}},15:function(e,t,n){e.exports={full:"Rating_full__3bNn9",empty:"Rating_empty__3eQth"}},16:function(e,t,n){e.exports={item:"PlaceCard_item__3-1ro",imageWrapper:"PlaceCard_imageWrapper__HAd4F"}},19:function(e,t,n){e.exports={item:"InfoWindowContent_item__8nKYS"}},20:function(e,t,n){e.exports={controls:"NavBar_controls__3zkfk"}},21:function(e,t,n){e.exports={item:"List_item__2TG5m"}},27:function(e,t,n){},36:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n.n(a),r=n(11),s=n.n(r),o=(n(27),n(3)),i=n(17),l=n(10),d=function(){return Object(l.b)()},u=l.c,j=n(0),b=Object(a.createContext)({isGoogleLoaded:!1,mapInstance:null,setMapInstance:function(){}});var p,f=function(e){var t=e.children,n=Object(a.useState)(!1),c=Object(o.a)(n,2),r=c[0],s=c[1],i=Object(a.useState)(null),l=Object(o.a)(i,2),d=l[0],u=l[1];return Object(a.useEffect)((function(){return function(e,t){var n=document.createElement("script");n.setAttribute("src",e),n.addEventListener("load",t),document.head.appendChild(n)}("https://maps.googleapis.com/maps/api/js?key=".concat("AIzaSyDQSd210wKX_7cz9MELkxhaEOUhFP0AkSk","&libraries=places"),(function(){s(!0)})),function(){}}),[]),Object(j.jsx)(b.Provider,{value:{isGoogleLoaded:r,mapInstance:d,setMapInstance:u},children:t})},m=n(5),g=n.n(m),h=n(7),O=n(4);!function(e){e[e.RatingsDescending=0]="RatingsDescending",e[e.RatingsAscending=1]="RatingsAscending"}(p||(p={}));var v={places:[],selectedPlace:null,isLoading:!1,sort:p.RatingsDescending},x=Object(O.b)("places/search",function(){var e=Object(h.a)(g.a.mark((function e(t){var n,a,c,r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.coordinates,a=t.service,c=t.query,r={location:new google.maps.LatLng(n.latitude,n.longitude),keyword:c,radius:2e3,type:"restaurant"},e.abrupt("return",new Promise((function(e,t){a.nearbySearch(r,(function(n,a){if(![google.maps.places.PlacesServiceStatus.OK,google.maps.places.PlacesServiceStatus.ZERO_RESULTS].includes(a))return console.error("unexpected status when searching ".concat(a)),t(new Error("unknown error"));if(!n||0===n.length)return console.warn("no results [status=".concat(a,"] for ").concat(c)),e([]);var r=n.reduce((function(e,t){return t.geometry.location&&e.push({id:t.place_id,name:t.name,rating:t.rating,totalReviews:t.user_ratings_total,photoUrl:t.photos[0].getUrl({maxWidth:100,maxHeight:100}),priceLevel:t.price_level,coordinates:{latitude:t.geometry.location.lat(),longitude:t.geometry.location.lng()}}),e}),[]);return e(r)}))})));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),N=function(e,t){e.sort((function(e,n){return t===p.RatingsAscending?e.rating-n.rating:n.rating-e.rating}))},y=Object(O.c)({name:"places",initialState:v,reducers:{selectPlace:function(e,t){return e.selectedPlace=t.payload,e},toggleSort:function(e){return e.sort=e.sort===p.RatingsAscending?p.RatingsDescending:p.RatingsAscending,N(e.places,e.sort),e}},extraReducers:function(e){e.addCase(x.pending,(function(e){e.isLoading=!0})).addCase(x.fulfilled,(function(e,t){e.isLoading=!1;var n=t.payload;N(n,e.sort),null===e.selectedPlace||n.some((function(t){return t.id===e.selectedPlace.id}))||(e.selectedPlace=null),e.places=t.payload})).addCase(x.rejected,(function(e,t){console.error("error while getting places ".concat(t.payload)),e.isLoading=!1}))}}),w=y.actions,L=w.toggleSort,R=w.selectPlace,_=y.reducer,S=n(15),P=n.n(S),I=function(e){for(var t=e.rating,n=e.totalReviews,a=Math.floor(t),c=[],r=0;r<5;r++)c.push(Object(j.jsx)("i",{"data-testid":r<a?"filled-star":"empty-star",className:"bi ".concat(r<a?"".concat(P.a.full," bi-star-fill"):"".concat(P.a.empty," bi-star"))},r));return Object(j.jsxs)("span",{title:"".concat(t," star rating"),children:[c.map((function(e){return e}))," (",n,")"]})},k="favorites",C=function(){var e;return JSON.parse(null!==(e=localStorage.getItem(k))&&void 0!==e?e:JSON.stringify({}))},A={byId:C()},E=Object(O.c)({name:"favorites",initialState:A,reducers:{toggleFavorite:function(e,t){var n,a=t.payload,c=!(null!==(n=e.byId[a])&&void 0!==n&&n);e.byId[a]=c;var r=C();return r[a]=c,localStorage.setItem(k,JSON.stringify(r)),e}}}),B=E.actions.toggleFavorite,F=E.reducer,M=function(e){var t=d(),n=u((function(t){return{isFavorited:t.favorites.byId[e.place.id]}})).isFavorited;return Object(j.jsx)("button",{className:"btn btn-link",onClick:function(){t(B(e.place.id))},children:Object(j.jsx)("i",{className:"bi bi-heart".concat(n?"-fill":""," text-primary")})})},D=n(16),H=n.n(D),T=function(e){var t=Object(a.useState)(""),n=Object(o.a)(t,2),c=n[0],r=n[1];return Object(a.useEffect)((function(){e.place.priceLevel&&r(new Array(e.place.priceLevel).fill("$").join(""))}),[e.place.priceLevel]),Object(j.jsx)("div",{className:"".concat(e.className," card ").concat(H.a.item),children:Object(j.jsxs)("div",{className:"row g-0",children:[Object(j.jsx)("div",{className:"col-4",children:Object(j.jsx)("div",{className:H.a.imageWrapper,children:Object(j.jsx)("img",{src:e.place.photoUrl,alt:e.place.name})})}),Object(j.jsx)("div",{className:"col-1"}),Object(j.jsx)("div",{className:e.showHeartIcon?"col-6":"col-7",children:Object(j.jsxs)("div",{className:"card-body p-0",children:[Object(j.jsx)("h5",{className:"card-title text-truncate",children:e.place.name}),Object(j.jsx)(I,{rating:e.place.rating,totalReviews:e.place.totalReviews}),c&&Object(j.jsx)("p",{className:"card-text",children:c})]})}),e.showHeartIcon&&Object(j.jsx)("div",{className:"col-1",children:Object(j.jsx)(M,{place:e.place})})]})})},W=n(19),q=n.n(W),G=Object(a.forwardRef)((function(e,t){return Object(j.jsx)("div",{ref:t,children:Object(j.jsx)(T,{place:e.place,showHeartIcon:!1,className:"border-0 ".concat(q.a.item)})})})),J=function(e){var t=d(),n=u((function(e){return{coordinates:e.location.coordinates,isLoadingPlaces:e.places.isLoading,places:e.places.places,selectedPlace:e.places.selectedPlace}})),c=n.coordinates,r=n.isLoadingPlaces,s=n.places,l=n.selectedPlace,p=Object(a.createRef)(),f=Object(a.useReducer)((function(e,t){return{oldByPlaceId:e.currentByPlaceId,currentByPlaceId:t}}),{oldByPlaceId:{},currentByPlaceId:{}}),m=Object(o.a)(f,2),g=m[0],h=m[1];Object(a.useEffect)((function(){r&&h({})}),[r]);var O=Object(a.useContext)(b),v=O.isGoogleLoaded,x=O.mapInstance,N=O.setMapInstance;Object(a.useEffect)((function(){for(var e=0,t=Object.values(g.oldByPlaceId);e<t.length;e++){t[e].setMap(null)}}),[g,g.oldByPlaceId]),Object(a.useEffect)((function(){if(null!==w.current&&null!==l&&null!==p.current){var e=g.currentByPlaceId[l.id];w.current.setContent(p.current),w.current.open(x,e)}}),[l,s,x,g.currentByPlaceId,p]),Object(a.useEffect)((function(){if(null!==x){var e,n={},a=Object(i.a)(s);try{var c=function(){var a=e.value,c=new google.maps.Marker({map:x,position:new google.maps.LatLng(a.coordinates.latitude,a.coordinates.longitude)});google.maps.event.addListener(c,"click",(function(){t(R(a))})),n[a.id]=c};for(a.s();!(e=a.n()).done;)c()}catch(r){a.e(r)}finally{a.f()}h(n)}}),[t,s,x]);var y=Object(a.useRef)(null),w=Object(a.useRef)(null);Object(a.useEffect)((function(){if(v&&null!==c&&null===x&&null!==y.current){null===w.current&&(w.current=new google.maps.InfoWindow);var e=new google.maps.Map(y.current,{center:new google.maps.LatLng(c.latitude,c.longitude),zoom:15});N(e)}}),[v,x,N,c]);var L=null===c;return Object(j.jsxs)("div",{id:"map",className:"".concat(e.className," w-100 h-100"),ref:y,children:[L&&Object(j.jsx)("div",{children:"Loading..."}),null!==l&&Object(j.jsx)(G,{ref:p,place:l})]})},U=n(20),z=n.n(U),K=n(22),Q=[{text:"Ratings High to Low",sort:p.RatingsDescending},{text:"Ratings Low to High",sort:p.RatingsAscending}],X=Object(a.forwardRef)((function(e,t){var n=Object(a.useState)(e.sort),c=Object(o.a)(n,2),r=c[0],s=c[1];return Object(j.jsx)("div",{className:"modal fade",tabIndex:-1,ref:t,children:Object(j.jsx)("div",{className:"modal-dialog",children:Object(j.jsxs)("div",{className:"modal-content",children:[Object(j.jsx)("div",{className:"modal-body",children:Object(j.jsx)("form",{children:Q.map((function(e,t){return Object(j.jsx)("div",{className:"form-check",children:Object(j.jsxs)("label",{className:"form-check-label",children:[Object(j.jsx)("input",{className:"form-check-input",name:"sort",type:"radio",onChange:function(){s(e.sort)},checked:r===e.sort}),e.text]})},t)}))})}),Object(j.jsx)("div",{className:"modal-footer",children:Object(j.jsx)("button",{type:"button",className:"btn btn-link","data-bs-dismiss":"modal",onClick:function(){e.onApply(r)},children:"Apply"})})]})})})})),Y=function(){var e=d(),t=Object(a.createRef)(),n=Object(a.useRef)(null),c=u((function(e){return{sortType:e.places.sort}})).sortType,r=u((function(e){return{isLoadingResults:e.places.isLoading,coordinates:e.location.coordinates}})),s=r.isLoadingResults,o=r.coordinates;return Object(j.jsxs)("div",{children:[Object(j.jsx)("button",{className:"btn btn-outline-primary me-2",type:"button",disabled:s||null===o,onClick:function(){null!==t.current&&null===n.current&&(n.current=new K.a(t.current)),null!==n.current&&n.current.toggle()},children:"Sort"}),Object(j.jsx)(X,{ref:t,sort:c,onApply:function(t){t!==c&&e(L())}})]})},Z=function(){var e=d(),t=u((function(e){return{isLoadingResults:e.places.isLoading,coordinates:e.location.coordinates}})),n=t.isLoadingResults,c=t.coordinates,r=Object(a.useContext)(b),s=r.isGoogleLoaded,i=r.mapInstance,l=Object(a.useState)(null),p=Object(o.a)(l,2),f=p[0],m=p[1];return Object(a.useEffect)((function(){s&&null!==i&&m(new google.maps.places.PlacesService(i))}),[s,i,c]),Object(j.jsx)("form",{onSubmit:function(){var t=Object(h.a)(g.a.mark((function t(a){var r,s,o;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.preventDefault(),!n){t.next=3;break}return t.abrupt("return");case 3:if(null!==f&&null!==c){t.next=6;break}return alert("unknown error"),t.abrupt("return");case 6:s=new FormData(a.target),o="".concat(null!==(r=s.get("query"))&&void 0!==r?r:"");try{e(x({service:f,coordinates:c,query:o}))}catch(i){console.error("error while searching ".concat(i))}case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),children:Object(j.jsxs)("div",{className:"input-group",children:[Object(j.jsx)("input",{type:"text",name:"query",disabled:n||null===c,className:"form-control",placeholder:"Search for a restaurant","aria-label":"Search for a restaurant"}),Object(j.jsx)("button",{className:"btn btn-outline-secondary",type:"button",children:Object(j.jsx)("i",{className:"bi bi-search text-primary"})})]})})},$=function(e){return Object(j.jsx)("nav",{className:"".concat(e.className," navbar navbar-expand-lg navbar-light bg-white shadow-sm ").concat(z.a.nav),children:Object(j.jsxs)("div",{className:"container-fluid",children:[Object(j.jsxs)("a",{className:"navbar-brand d-flex justify-center",href:"/",children:[Object(j.jsx)("img",{src:"/logo.svg",alt:"AllTrails logo"})," ",Object(j.jsx)("span",{className:"ms-2 fs-4",children:"at Lunch"})]}),Object(j.jsxs)("div",{className:"d-flex",children:[Object(j.jsx)(Y,{}),Object(j.jsx)(Z,{})]})]})})},V=Object(O.b)("location",Object(h.a)(g.a.mark((function e(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){navigator.geolocation.getCurrentPosition((function(t){e({latitude:t.coords.latitude,longitude:t.coords.longitude})}),t,{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})})));case 1:case"end":return e.stop()}}),e)})))),ee=Object(O.c)({name:"location",initialState:{value:0,isLoading:!1,coordinates:null},reducers:{increment:function(e){e.value++},decrement:function(e){e.value--}},extraReducers:function(e){e.addCase(V.pending,(function(e,t){e.isLoading=!0})).addCase(V.fulfilled,(function(e,t){e.isLoading=!1,e.coordinates=t.payload})).addCase(V.rejected,(function(e,t){console.error("error while getting location ".concat(t.payload)),e.isLoading=!1}))}}),te=ee.actions,ne=(te.increment,te.decrement,ee.reducer),ae=Object(O.a)({reducer:{location:ne,places:_,favorites:F}}),ce=(n(36),n(12)),re=n.n(ce),se=n(21),oe=n.n(se),ie=function(e){var t=u((function(e){return{isLoadingResults:e.places.isLoading,places:e.places.places}})),n=t.isLoadingResults,a=t.places;return Object(j.jsx)("div",{className:"".concat(e.className," overflow-scroll h-100"),children:n?Object(j.jsx)("div",{className:"card","aria-hidden":"true",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsx)("h5",{className:"card-title placeholder-glow",children:Object(j.jsx)("span",{className:"placeholder col-6"})}),Object(j.jsxs)("p",{className:"card-text placeholder-glow",children:[Object(j.jsx)("span",{className:"placeholder col-7"}),Object(j.jsx)("span",{className:"placeholder col-4"}),Object(j.jsx)("span",{className:"placeholder col-4"}),Object(j.jsx)("span",{className:"placeholder col-6"}),Object(j.jsx)("span",{className:"placeholder col-8"})]})]})}):n||0!==a.length?a.map((function(e){return Object(j.jsx)(T,{className:"mb-3 p-3 ".concat(oe.a.item),place:e,showHeartIcon:!0},e.id)})):Object(j.jsx)("div",{className:"card","aria-hidden":"true",children:Object(j.jsx)("div",{className:"card-body",children:Object(j.jsx)("h5",{className:"card-title",children:"No results! \ud83d\ude22"})})})})};ae.dispatch(V());var le=function(){var e=Object(a.useState)(!1),t=Object(o.a)(e,2),n=t[0],c=t[1];return Object(j.jsx)(l.a,{store:ae,children:Object(j.jsx)(f,{children:Object(j.jsx)("div",{className:"vw-100 vh-100 bg-light",children:Object(j.jsxs)("div",{className:"container h-100 ".concat(re.a.container),children:[Object(j.jsx)($,{className:re.a.nav}),Object(j.jsxs)("main",{className:"".concat(re.a.main," overflow-hidden h-100"),children:[Object(j.jsxs)("div",{className:"row h-100",children:[Object(j.jsx)(ie,{className:"p-3 bg-light d-sm-block col-sm-4 ".concat(!n&&"d-none")}),Object(j.jsx)(J,{className:"d-sm-block col ".concat(n&&"d-none")})]}),Object(j.jsxs)("button",{className:"btn btn-primary d-sm-none mb-3 position-fixed start-50 fixed-bottom translate-middle",onClick:function(){c(!n)},children:[Object(j.jsx)("i",{className:"bi bi-".concat(n?"geo-alt":"list-ul")}),n?"Map":"List"]})]})]})})})})},de=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,40)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,s=t.getTTFB;n(e),a(e),c(e),r(e),s(e)}))};s.a.render(Object(j.jsx)(c.a.StrictMode,{children:Object(j.jsx)(le,{})}),document.getElementById("root")),de()}},[[37,1,2]]]);
//# sourceMappingURL=main.c41787fc.chunk.js.map