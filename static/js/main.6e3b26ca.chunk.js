(this["webpackJsonpalltrails-at-lunch"]=this["webpackJsonpalltrails-at-lunch"]||[]).push([[0],{12:function(e,t,n){e.exports={container:"App_container__38atM",nav:"App_nav__2qex2",main:"App_main__3N4Nf"}},16:function(e,t,n){e.exports={full:"Rating_full__nAF1e",empty:"Rating_empty__3aT7i"}},18:function(e,t,n){e.exports={controls:"NavBar_controls__3zkfk"}},19:function(e,t,n){e.exports={item:"ListItem_item__opwmm"}},25:function(e,t,n){},34:function(e,t,n){},35:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n.n(a),s=n(11),r=n.n(s),o=(n(25),n(3)),i=n(14),l=n(10),d=function(){return Object(l.b)()},u=l.c,j=n(0),b=Object(a.createContext)({isGoogleLoaded:!1,mapInstance:null,setMapInstance:function(){}});var p,m=function(e){var t=e.children,n=Object(a.useState)(!1),c=Object(o.a)(n,2),s=c[0],r=c[1],i=Object(a.useState)(null),l=Object(o.a)(i,2),d=l[0],u=l[1];return Object(a.useEffect)((function(){return function(e,t){var n=document.createElement("script");n.setAttribute("src",e),n.addEventListener("load",t),document.head.appendChild(n)}("https://maps.googleapis.com/maps/api/js?key=".concat("AIzaSyDQSd210wKX_7cz9MELkxhaEOUhFP0AkSk","&libraries=places"),(function(){r(!0)})),function(){}}),[]),Object(j.jsx)(b.Provider,{value:{isGoogleLoaded:s,mapInstance:d,setMapInstance:u},children:t})},f=function(e){var t=u((function(e){return{coordinates:e.location.coordinates,isLoadingPlaces:e.places.isLoading,places:e.places.places}})),n=t.coordinates,c=t.isLoadingPlaces,s=t.places,r=Object(a.useState)(null),l=Object(o.a)(r,2),d=l[0],p=l[1],m=Object(a.useReducer)((function(e,t){return{old:e.new,new:t}}),{old:[],new:[]}),f=Object(o.a)(m,2),g=f[0],h=f[1];Object(a.useEffect)((function(){c&&h([])}),[c]);var O=Object(a.useContext)(b),v=O.isGoogleLoaded,x=O.mapInstance,N=O.setMapInstance;Object(a.useEffect)((function(){if(g.old.length>0){var e,t=Object(i.a)(g.old);try{for(t.s();!(e=t.n()).done;){e.value.setMap(null)}}catch(n){t.e(n)}finally{t.f()}}}),[g,g.old]),Object(a.useEffect)((function(){if(null!==w.current&&null!==d){var e=function(e){var t=document.createElement("div"),n=document.createElement("h2");n.textContent=e.name,t.appendChild(n);var a=document.createElement("p");return a.textContent=e.id,t.appendChild(a),t}(d.place);w.current.setContent(e),w.current.open(x,d.marker)}}),[d,x]),Object(a.useEffect)((function(){if(null!==x){var e,t=[],n=Object(i.a)(s);try{var a=function(){var n=e.value,a=new google.maps.Marker({map:x,position:new google.maps.LatLng(n.coordinates.latitude,n.coordinates.longitude)});google.maps.event.addListener(a,"click",(function(){p({place:n,marker:a})})),t.push(a)};for(n.s();!(e=n.n()).done;)a()}catch(c){n.e(c)}finally{n.f()}h(t)}}),[s,x]);var y=Object(a.useRef)(null),w=Object(a.useRef)(null);Object(a.useEffect)((function(){if(v&&null!==n&&null===x&&null!==y.current){null===w.current&&(w.current=new google.maps.InfoWindow);var e=new google.maps.Map(y.current,{center:new google.maps.LatLng(n.latitude,n.longitude),zoom:15});N(e)}}),[v,x,N,n]);var L=null===n;return Object(j.jsx)("div",{id:"map",className:"".concat(e.className," w-100 h-100"),ref:y,children:L&&Object(j.jsx)("div",{children:"Loading..."})})},g=n(18),h=n.n(g),O=n(20);!function(e){e[e.RatingsDescending=0]="RatingsDescending",e[e.RatingsAscending=1]="RatingsAscending"}(p||(p={}));var v=n(5),x=n.n(v),N=n(7),y=n(4),w={places:[],isLoading:!1,sort:p.RatingsDescending},L=Object(y.b)("places/search",function(){var e=Object(N.a)(x.a.mark((function e(t){var n,a,c,s;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.coordinates,a=t.service,c=t.query,s={location:new google.maps.LatLng(n.latitude,n.longitude),keyword:c,radius:2e3,type:"restaurant"},e.abrupt("return",new Promise((function(e,t){a.nearbySearch(s,(function(n,a){if(![google.maps.places.PlacesServiceStatus.OK,google.maps.places.PlacesServiceStatus.ZERO_RESULTS].includes(a))return console.error("unexpected status when searching ".concat(a)),t(new Error("unknown error"));if(!n||0===n.length)return console.warn("no results [status=".concat(a,"] for ").concat(c)),e([]);var s=n.reduce((function(e,t){return t.geometry.location&&e.push({id:t.place_id,name:t.name,rating:t.rating,totalReviews:t.user_ratings_total,photoUrl:t.photos[0].getUrl({maxWidth:100,maxHeight:100}),priceLevel:t.price_level,coordinates:{latitude:t.geometry.location.lat(),longitude:t.geometry.location.lng()}}),e}),[]);return e(s)}))})));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),k=function(e,t){e.sort((function(e,n){return t===p.RatingsAscending?e.rating-n.rating:n.rating-e.rating}))},R=Object(y.c)({name:"places",initialState:w,reducers:{toggleSort:function(e){return e.sort=e.sort===p.RatingsAscending?p.RatingsDescending:p.RatingsAscending,k(e.places,e.sort),e}},extraReducers:function(e){e.addCase(L.pending,(function(e){e.isLoading=!0})).addCase(L.fulfilled,(function(e,t){e.isLoading=!1,k(t.payload,e.sort),e.places=t.payload})).addCase(L.rejected,(function(e,t){console.error("error while getting places ".concat(t.payload)),e.isLoading=!1}))}}),S=R.actions.toggleSort,_=R.reducer,C=Object(a.forwardRef)((function(e,t){return Object(j.jsx)("div",{className:"modal fade",tabIndex:-1,ref:t,children:Object(j.jsx)("div",{className:"modal-dialog",children:Object(j.jsxs)("div",{className:"modal-content",children:[Object(j.jsx)("div",{className:"modal-body",children:Object(j.jsxs)("form",{children:[Object(j.jsx)("div",{className:"form-check",children:Object(j.jsxs)("label",{className:"form-check-label",children:[Object(j.jsx)("input",{className:"form-check-input",name:"sort",type:"radio",onChange:e.onToggle,checked:e.sort===p.RatingsDescending}),"Ratings High to Low"]})}),Object(j.jsx)("div",{className:"form-check",children:Object(j.jsxs)("label",{className:"form-check-label",children:[Object(j.jsx)("input",{className:"form-check-input",name:"sort",type:"radio",onChange:e.onToggle,checked:e.sort===p.RatingsAscending}),"Ratings Low to High"]})})]})}),Object(j.jsx)("div",{className:"modal-footer",children:Object(j.jsx)("button",{type:"button",className:"btn btn-link","data-bs-dismiss":"modal",children:"Apply"})})]})})})})),E=function(){var e=d(),t=Object(a.createRef)(),n=Object(a.useRef)(null),c=u((function(e){return{sortType:e.places.sort}})).sortType,s=u((function(e){return{isLoadingResults:e.places.isLoading,coordinates:e.location.coordinates}})),r=s.isLoadingResults,o=s.coordinates;return Object(j.jsxs)("div",{children:[Object(j.jsx)("button",{className:"btn btn-outline-primary me-2",type:"button",disabled:r||null===o,onClick:function(){null!==t.current&&null===n.current&&(console.log("sure"),n.current=new O.a(t.current)),null!==n.current&&n.current.toggle()},children:"Sort"}),Object(j.jsx)(C,{ref:t,sort:c,onToggle:function(){e(S())}})]})},I=function(){var e=d(),t=u((function(e){return{isLoadingResults:e.places.isLoading,coordinates:e.location.coordinates}})),n=t.isLoadingResults,c=t.coordinates,s=Object(a.useContext)(b),r=s.isGoogleLoaded,i=s.mapInstance,l=Object(a.useState)(null),p=Object(o.a)(l,2),m=p[0],f=p[1];return Object(a.useEffect)((function(){r&&null!==i&&f(new google.maps.places.PlacesService(i))}),[r,i,c]),Object(j.jsx)("form",{onSubmit:function(){var t=Object(N.a)(x.a.mark((function t(a){var s,r,o;return x.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.preventDefault(),!n){t.next=3;break}return t.abrupt("return");case 3:if(null!==m&&null!==c){t.next=6;break}return alert("unknown error"),t.abrupt("return");case 6:r=new FormData(a.target),o="".concat(null!==(s=r.get("query"))&&void 0!==s?s:"");try{e(L({service:m,coordinates:c,query:o}))}catch(i){console.error("error while searching ".concat(i))}case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),children:Object(j.jsxs)("div",{className:"input-group",children:[Object(j.jsx)("input",{type:"text",name:"query",disabled:n||null===c,className:"form-control",placeholder:"Search for a restaurant","aria-label":"Search for a restaurant"}),Object(j.jsx)("button",{className:"btn btn-outline-secondary",type:"button",children:Object(j.jsx)("i",{className:"bi bi-search text-primary"})})]})})},A=function(e){return Object(j.jsx)("nav",{className:"".concat(e.className," navbar navbar-expand-lg navbar-light bg-white shadow-sm ").concat(h.a.nav),children:Object(j.jsxs)("div",{className:"container-fluid",children:[Object(j.jsxs)("a",{className:"navbar-brand d-flex justify-center",href:"/",children:[Object(j.jsx)("img",{src:"/logo.svg",alt:"AllTrails logo"})," ",Object(j.jsx)("span",{className:"ms-2 fs-4",children:"at Lunch"})]}),Object(j.jsxs)("div",{className:"d-flex",children:[Object(j.jsx)(E,{}),Object(j.jsx)(I,{})]})]})})},P="favorites",F=function(){var e;return JSON.parse(null!==(e=localStorage.getItem(P))&&void 0!==e?e:JSON.stringify({}))},M={byId:F()},T=Object(y.c)({name:"favorites",initialState:M,reducers:{toggleFavorite:function(e,t){var n,a=t.payload,c=!(null!==(n=e.byId[a])&&void 0!==n&&n);e.byId[a]=c;var s=F();return s[a]=c,localStorage.setItem(P,JSON.stringify(s)),e}}}),D=T.actions.toggleFavorite,q=T.reducer,J=Object(y.b)("location",Object(N.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){navigator.geolocation.getCurrentPosition((function(t){e({latitude:t.coords.latitude,longitude:t.coords.longitude})}),t,{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})})));case 1:case"end":return e.stop()}}),e)})))),U=Object(y.c)({name:"location",initialState:{value:0,isLoading:!1,coordinates:null},reducers:{increment:function(e){e.value++},decrement:function(e){e.value--}},extraReducers:function(e){e.addCase(J.pending,(function(e,t){e.isLoading=!0})).addCase(J.fulfilled,(function(e,t){e.isLoading=!1,e.coordinates=t.payload})).addCase(J.rejected,(function(e,t){console.error("error while getting location ".concat(t.payload)),e.isLoading=!1}))}}),z=U.actions,G=(z.increment,z.decrement,U.reducer),H=Object(y.a)({reducer:{location:G,places:_,favorites:q}}),B=(n(34),n(12)),K=n.n(B),W=n(19),Q=n.n(W),X=n(16),Z=n.n(X),$=function(e){for(var t=e.rating,n=e.totalReviews,a=Math.floor(t),c=[],s=0;s<5;s++)c.push(Object(j.jsx)("i",{"data-testid":s<a?"filled-star":"empty-star",className:"bi ".concat(s<a?"".concat(Z.a.full," bi-star-fill"):"".concat(Z.a.empty," bi-star"))},s));return Object(j.jsxs)("span",{title:"".concat(t," star rating"),children:[c.map((function(e){return e}))," (",n,")"]})},V=function(e){var t=Object(a.useState)(""),n=Object(o.a)(t,2),c=n[0],s=n[1],r=d(),i=u((function(t){return{isFavorited:t.favorites.byId[e.place.id]}})).isFavorited;return Object(a.useEffect)((function(){e.place.priceLevel&&s(new Array(e.place.priceLevel).fill("$").join(""))}),[e.place.priceLevel]),Object(j.jsx)("div",{className:"".concat(e.className," card p-3 ").concat(Q.a.item),children:Object(j.jsxs)("div",{className:"row g-0",children:[Object(j.jsx)("div",{className:"col-md-4",children:Object(j.jsx)("img",{className:"img",alt:"".concat(e.place.name),src:e.place.photoUrl})}),Object(j.jsx)("div",{className:"col-md-7",children:Object(j.jsxs)("div",{className:"card-body p-0",children:[Object(j.jsx)("h5",{className:"card-title text-truncate",children:e.place.name}),Object(j.jsx)($,{rating:e.place.rating,totalReviews:e.place.totalReviews}),c&&Object(j.jsx)("p",{className:"card-text",children:c})]})}),Object(j.jsx)("div",{className:"col-md-1",children:Object(j.jsx)("button",{className:"btn btn-link",onClick:function(){r(D(e.place.id))},children:Object(j.jsx)("i",{className:"bi bi-heart".concat(i?"-fill":""," text-primary")})})})]})})},Y=function(e){var t=u((function(e){return{isLoadingResults:e.places.isLoading,places:e.places.places}})),n=t.isLoadingResults,a=t.places;return Object(j.jsx)("div",{className:"".concat(e.className," overflow-scroll h-100"),children:n?Object(j.jsx)("div",{className:"card","aria-hidden":"true",children:Object(j.jsxs)("div",{className:"card-body",children:[Object(j.jsx)("h5",{className:"card-title placeholder-glow",children:Object(j.jsx)("span",{className:"placeholder col-6"})}),Object(j.jsxs)("p",{className:"card-text placeholder-glow",children:[Object(j.jsx)("span",{className:"placeholder col-7"}),Object(j.jsx)("span",{className:"placeholder col-4"}),Object(j.jsx)("span",{className:"placeholder col-4"}),Object(j.jsx)("span",{className:"placeholder col-6"}),Object(j.jsx)("span",{className:"placeholder col-8"})]})]})}):n||0!==a.length?a.map((function(e){return Object(j.jsx)(V,{className:"mb-3",place:e},e.id)})):Object(j.jsx)("div",{className:"card","aria-hidden":"true",children:Object(j.jsx)("div",{className:"card-body",children:Object(j.jsx)("h5",{className:"card-title",children:"No results! \ud83d\ude22"})})})})};H.dispatch(J());var ee=function(){var e=Object(a.useState)(!1),t=Object(o.a)(e,2),n=t[0],c=t[1];return Object(j.jsx)(l.a,{store:H,children:Object(j.jsx)(m,{children:Object(j.jsx)("div",{className:"vw-100 vh-100 bg-light",children:Object(j.jsxs)("div",{className:"container h-100 ".concat(K.a.container),children:[Object(j.jsx)(A,{className:K.a.nav}),Object(j.jsxs)("main",{className:"".concat(K.a.main," overflow-hidden h-100"),children:[Object(j.jsxs)("div",{className:"row h-100",children:[Object(j.jsx)(Y,{className:"p-3 bg-light d-sm-block col-sm-4 ".concat(!n&&"d-none")}),Object(j.jsx)(f,{className:"d-sm-block col ".concat(n&&"d-none")})]}),Object(j.jsxs)("button",{className:"btn btn-primary d-sm-none mb-3 position-fixed start-50 fixed-bottom translate-middle",onClick:function(){c(!n)},children:[Object(j.jsx)("i",{className:"bi bi-".concat(n?"geo-alt":"list-ul")}),n?"Map":"List"]})]})]})})})})},te=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,38)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,s=t.getLCP,r=t.getTTFB;n(e),a(e),c(e),s(e),r(e)}))};r.a.render(Object(j.jsx)(c.a.StrictMode,{children:Object(j.jsx)(ee,{})}),document.getElementById("root")),te()}},[[35,1,2]]]);
//# sourceMappingURL=main.6e3b26ca.chunk.js.map